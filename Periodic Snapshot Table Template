-- Create a Periodic Snapshot Fact Table
IF NOT EXISTS (SELECT * FROM DB.Table WHERE name = 'TableNameHere')
BEGIN
    CREATE TABLE TableNameHere (
        SnapshotDate DATE,
        ProductID INT,
        LocationID INT,
        InventoryCount INT,
        CONSTRAINT PK_WeeklyInventory PRIMARY KEY (SnapshotDate, ProductID, LocationID)
    );
END;

-- Scheduled SQL Job to Capture Weekly Snapshots
INSERT INTO WeeklyInventorySnapshots (SnapshotDate, ProductID, LocationID, InventoryCount)
SELECT
    CAST(GETDATE() AS DATE) AS SnapshotDate,
    ProductID,
    LocationID,
    SUM(StockQuantity) AS InventoryCount
FROM
    InventoryTable
WHERE
    LastUpdated >= DATEADD(DAY, -7, CAST(GETDATE() AS DATE))
GROUP BY
    ProductID, LocationID;
-- END
